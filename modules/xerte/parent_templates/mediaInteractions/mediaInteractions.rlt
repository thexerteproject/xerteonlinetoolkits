	<LO description="A  template for presenting a piece of media and creating a series of interactions " targetFolder="mediaInteractions" version="1.0" styleSheet="templatePath + 'common/styles.css'" selectableText="1" templateData="FileLocation + 'template.xml'" name="Media Interactions">		<SCR name="makePages"><![CDATA[//loop through the xml and insert a page of the right type for each page typeifc = icon.nextSibling;pageStore = icon.parentNode.getChildByName('pageStore');linkIndex = -1;pgOffset = 1;for (i = 0; i < extXML.firstChild.childNodes.length; i++){  //build this file dynamically  modName = extXML.firstChild.childNodes[i].nodeName;    if (modName == 'xerteModel'){    newXML = new XML('<PG model="' + extXML.firstChild.childNodes[i].attributes.modelFile + '"/>');    //is there an initObject...?    if (extXML.firstChild.childNodes[i].attributes.initObject != undefined){      newXML.firstChild.attributes.initObject = extXML.firstChild.childNodes[i].attributes.initObject;    }  } else {    newXML = new XML('<PG model="templatePath + \'models/' + modName + '.rlm\'"/>');  }  newChild = newXML.firstChild;  newChild.attributes.title = extXML.firstChild.childNodes[i].attributes.name;  newChild.attributes.linkID = extXML.firstChild.childNodes[i].attributes.linkID;    if (extXML.firstChild.childNodes[i].attributes.linkID == _level0.linkID && extXML.firstChild.childNodes[i].attributes.linkID != undefined){    linkIndex = i;  }  ifc.appendChild(newChild);}]]></SCR>		<IFC name="interface" title="My Learning Object" visuals="1">			<FW_ENT id="entryFrame" name="background">				<DIS id="bgRect" name="backgroundRect" x="0" y="0" type="ext" url="FileLocation + "><![CDATA[]]></DIS>				<DIS id="helpIcon" name="helpIcon" x="750" y="470" type="ext" url="templatePath + 'common/help.png'"><![CDATA[Help Button]]></DIS>				<DIS id="lessonImage" y="-1" h="516" w="342" name="lessonImage" x="9" type="ext" url="coded"><![CDATA[]]></DIS>				<DIS id="toggle" textSize="10" name="mediaAndTranscript" x="540" y="484" w="200" h="10" type="text"><![CDATA[<b><u>Show Transcript</u></b>]]></DIS>				<INT name="lessonImageEvents" perpetual="1">					<RES name="onLoad" type="event" eventName="onLoad" icon="lessonImage" erase="1" exit="0">						<SCR name="showFW_ENT"><![CDATA[lessonImage._x = 9;lessonImage._y = baseY;lessonImage._width = 342;lessonImage._height = transcriptH;entryFrame._visible = true;]]></SCR>					</RES>					<RES name="onRelease" type="event" eventName="onRelease" icon="toggle" erase="1" exit="0">						<SCR name="toggleDisplay"><![CDATA[if (lessonImage._x == 9){  toggle.setText('<b><u>Hide Transcript</u></b>');  lessonImage.animate(-400,lessonImage._y,20,'linearTween');} else {  toggle.setText('<b><u>Show Transcript</u></b>');  lessonImage.animate(9,lessonImage._y,20,'linearTween');}]]></SCR>					</RES>				</INT>				<SCR isFunc="1" name="fLoadImage"><![CDATA[if (args[0] != undefined){  entryFrame._visible = false;  lessonImage.loadImage(expression(args[0], _level0.engine));}]]></SCR>				<SCR isFunc="1" name="fShowMedia"><![CDATA[if (args[0] == 'true'){  toggle.setText('<b><u>Hide Transcript</u></b>');  lessonImage._x = -400;} else {  toggle.setText('<b><u>Show Transcript</u></b>');  lessonImage._x = 9;}]]></SCR>				<SCR isFunc="1" name="playChunk"><![CDATA[lastChunk = 0;fIndex = args[0];pos = 0; endTime = Number(trans.p[fIndex].end);playingChunk = true;ticks = 0;if (mediaType == 'sound'){  mediaIcon.play(Number(trans.p[fIndex].begin * 1000));}if (mediaType == 'video'){  mediaIcon.flvPlayer.seek(Number(trans.p[fIndex].begin));  mediaIcon.flvPlayer.play();}if (mediaType == 'youtube'){  engine[ytIDMain].seekTo(Number(trans.p[fIndex].begin));}chunk = chunks.children[fIndex];chunk.beginFill(0xFFFF00,100);chunk.drawRect(0,0,chunk._width,chunk._height);scrPane.setScrollPosition(0,chunk._y);]]></SCR>				<SCR isFunc="1" name="stopChunk"><![CDATA[pos = 0;if (mediaType == 'sound'){  mediaIcon.reset();} else if (mediaType == 'video'{  mediaIcon.stop();   mediaIcon.reset();} else if (mediaType == 'youtube'){  engine[ytIDMain].stopVideo()}playingChunk = false;]]></SCR>				<SCR name="soundOrVideo"><![CDATA[entryFrame.beginFill(STYLES.statusBarColour, 100);entryFrame.drawRect(0,0,360,516);bgRect.beginFill(0xFFFFFF,100);entryFrame.swapDepths(99);lessonImage.swapDepths(99);rootIcon.trackTextFields();if (templateData.learningObject[0].media.indexOf('.flv') != -1){  //video  mediaType = 'video';  icon.nextSibling.getChildByName('sound').removeNode();  icon.nextSibling.getChildByName('youtube').removeNode();    //baseY and transcriptH set in loader  chunkHeight = 10;  } else if (templateData.learningObject[0].media.indexOf('.mp3') != -1){ //sound  mediaType = 'sound';  icon.nextSibling.getChildByName('video').removeNode();  icon.nextSibling.getChildByName('youtube').removeNode();  bgRect.drawRect(10,32,340,474);    baseY = 30;  transcriptH = 474;  chunkHeight = 10;  } else if (templateData.learningObject[0].media.indexOf('<object') != -1){ //youtube  mediaType = 'youtube';  icon.nextSibling.getChildByName('video').removeNode();  icon.nextSibling.getChildByName('sound').removeNode();    bgRect.drawRect(10,302,340,210);    baseY = 302;  transcriptH = 210;  chunkHeight = 312;  } else {  mediaType = 'text';  icon.nextSibling.removeNode(); //no media  bgRect.drawRect(10,1,340,514);    baseY = 0;  transcriptH = 514;  chunkHeight = 514;}]]></SCR>				<DEC name="media" repeat="all" branch="sequence" pause="0" erase="0" eraseOnExit="0">					<PG name="video">						<MOV w="340" id="mediaIcon" name="video" x="10" y="0" url="{templateData.learningObject[0].media}" controls="1" play="0"><![CDATA[]]></MOV>						<INT name="loadMedia" perpetual="0">							<RES name="loader" type="event" eventName="onMovieReady" icon="mediaIcon" erase="1" exit="1">								<SCR name="getDimensions"><![CDATA[transcriptH = 474 - mediaIcon._height;baseY = mediaIcon._y + mediaIcon._height + 30;bgRect.drawRect(10,mediaIcon._y + mediaIcon._height + 30,340,transcriptH);]]></SCR>							</RES>						</INT>					</PG>					<PG name="sound">						<SND id="mediaIcon" controls="10,0,340" name="sound" type="ext" url="{templateData.learningObject[0].media}" play="0" loop="0" wait="0" />					</PG>					<PG name="youtube">						<SCR name="setup"><![CDATA[xml = new XML(templateData.learningObject[0].media);embedObj = xml.toObject();//two types of embed code...if (embedObj.object[0].embed[0].src.split('/')[4].indexOf('?') != -1){  vidID = embedObj.object[0].embed[0].src.split('/')[4].split('?')[0];} else {  vidID = embedObj.object[0].embed[0].src.split('/')[4].split('&')[0];}d = new Date();ytIDMain = 'yt' + d.getTime();icon.parentNode.getChildByName('youtube').attributes.id = ytIDMain;]]></SCR>						<DIS h="290" w="340" tabIndex="-1" id="panel" name="panel" x="10" y="0" type="ext" url="templatePath + 'common/whitePanel.swf'"><![CDATA[]]></DIS>						<DIS textColour="#999999" textSize="10" id="status" name="status" x="panel._x + 62" y="panel._y + 262" w="240" h="10" type="text"><![CDATA[Player Loading...]]></DIS>						<COM id="coded" y="panel._y + 10" x="panel._x+ 10" name="youtube" url="templatePath + 'common/youtube.swf?' + yt" initObject="{ id: vidID}" />						<SCR name="setup"><![CDATA[status.txt.selectable = false;status.lineStyle(0,0x999999,100);status.drawRect(0,0,240,18);]]></SCR>						<INT id="mediaIcon" name="mediaIcon" perpetual="1">							<RES name="onPlayerLoad" type="event" eventName="onPlayerLoad" icon="engine[ytIDMain]" erase="1" exit="0">								<SCR name="handler"><![CDATA[btnToggle.setEnabled(true);btnPlay.setEnabled(true);status.setText("Press Play");rootIcon.enableControls(true, 100);]]></SCR>							</RES>							<RES name="onPlayerStateChange" type="event" eventName="onPlayerStateChange" icon="engine[ytIDMain]" erase="1" exit="0">								<SCR name="handler"><![CDATA[if (engine[ytIDMain].state == 1){  //playing  btnStop.setEnabled(true);  btnPause.setEnabled(true);       btnPlay._visible = false;  btnPause._visible = true;} else if (engine[ytIDMain].state == 2){  //paused  btnPlay.setEnabled(true);    btnPlay._visible = true;  btnPause._visible = false;  }]]></SCR>							</RES>							<RES name="onProgress" type="event" eventName="onProgress" icon="engine[ytIDMain]" erase="1" exit="0">								<SCR name="handler"><![CDATA[engine[ytIDMain].playerLoaded = true;if (engine[ytIDMain].statusStr.indexOf('-1') == -1 && engine[ytIDMain].statusStr.indexOf('NaN') == -1){  status.setText(engine[ytIDMain].statusStr);}status.clear();status.lineStyle(0,0x999999,100);status.drawRect(0,0,240,18);status.lineStyle();status.beginFill(STYLES.fillColour,50);status.drawRect(0,0,engine[ytIDMain].bytesPercent*2.4,18);status.lineStyle(0,0x999999,100);status.beginFill(STYLES.fillColour,100);status.drawRect(0,0,engine[ytIDMain].percent*2.4,18);]]></SCR>							</RES>							<RES name="onRelease" type="event" eventName="onRelease" icon="status" erase="1" exit="0">								<SCR name="seek"><![CDATA[nt = Math.floor(status._xmouse / 240 * engine[ytIDMain].duration);engine[ytIDMain].seekTo(nt ,true);]]></SCR>							</RES>							<RES toolTip="Stop Video" enabled="0" rs="btnStop" swf="templatePath + 'common/stopMedia.swf'" name="stop" type="button" x="panel._x + 10" y="260" label="Stop" erase="1" exit="0">								<SCR name="stop"><![CDATA[engine[ytIDMain].pauseVideo();engine[ytIDMain].seekTo(0,true);//reset the status informationstatus.setText('0:00 / ' + engine[ytIDMain].durationStr);status.clear();status.lineStyle(0,0x999999,100);status.drawRect(0,0,240,18);]]></SCR>							</RES>							<RES enabled="0" toolTip="Pause Video" rs="btnPause" swf="templatePath + 'common/pauseMedia.swf'" name="pause" type="button" x="panel._x + 35" y="260" label="Pause" erase="1" exit="0">								<SCR name="pause"><![CDATA[engine[ytIDMain].pauseVideo();]]></SCR>							</RES>							<RES enabled="0" toolTip="Play Video" rs="btnPlay" swf="templatePath + 'common/playMedia.swf'" name="play" type="button" x="panel._x + 35" y="260" label="Play" erase="1" exit="0">								<SCR name="play"><![CDATA[if (engine[ytIDMain].playerLoaded != true){  engine[ytIDMain].loadVideoById(vidID);  btnPlay.setEnabled(false);  status.setText("Loading...");} else {  engine[ytIDMain].playVideo();}]]></SCR>							</RES>							<RES toolTip="Toggle Fullscreen" enabled="0" rs="btnToggle" swf="templatePath + 'common/zoomMedia.swf'" name="toggle" type="button" x="panel._x + 308" y="260" label="Resize" erase="1" exit="0">								<SCR name="resize"><![CDATA[if (ytTog != true){  ytTog = true;  engine[ytIDMain].setSize(800,515);  engine[ytIDMain]._x = 0;  engine[ytIDMain]._y = 0;    btnStop._x = 10;  btnStop._y = 484;  btnPlay._x = 35;  btnPlay._y = 484;  btnPause._x = 35;  btnPause._y = 484;  btnToggle._x = 60;  btnToggle._y = 484;    myPage.swapDepths(99999);  scrPane._visible = false;  } else {  ytTog = false;  engine[ytIDMain].setSize(320,240);  engine[ytIDMain]._x = panel._x + 10;  engine[ytIDMain]._y = panel._y + 10;        btnStop._x = panel._x + 10;  btnStop._y = 260;  btnPlay._x = panel._x + 35;  btnPlay._y = 260;  btnPause._x = panel._x + 35;  btnPause._y = 260;  btnToggle._x = panel._x + 308;  btnToggle._y = 260;      scrPane._visible = true;}]]></SCR>							</RES>						</INT>					</PG>				</DEC>				<SCR name="makeTranscript"><![CDATA[rawTrans = templateData.learningObject[0].transcript;if (rawTrans.indexOf('<p begin') == -1){  rt = '<p begin="99999">' + rawTrans + '</p>';}//split the transcripttrans = new XML(rawTrans);trans.ignoreWhite = true;trans = trans.toObject();if (templateData.learningObject[0].transcript == ''){ //no transcript  icon.nextSibling.removeNode();  bgRect.removeMovieClip();}//variablesendTime = -1;playingChunk = false;chunkIndex = -1;lastChunk = 0;chunk = 0;if (icon.built != true){  icon.nextSibling.firstChild.firstChild.duplicate(trans.p.length - 1);  icon.built = true;}//all ready - now load the imagelessonImage.loadImage(templatePath + 'common/default.png');]]></SCR>				<DEC id="dec" name="transcriptChunks" repeat="all" branch="sequence" pause="0" erase="0" eraseOnExit="0">					<PG id="chunks" name="chunks">						<DIS id="protoChunk" textColour="#333333" name="protoChunk" x="0" y="icon.index() == 0 ? 0 : _ytile + 5" w="320" h="10" type="text"><![CDATA[{trans.p.length > 0 ?  trans.p[icon.index()] : rawTrans}]]></DIS>					</PG>					<PG name="makeScroller">						<SCR name="makeScroller"><![CDATA[scrPane = dec.attachMovie('FScrollPaneSymbol', 'scroller', -1);scrPane.setScrollContent(chunks);scrPane.setHScroll(false);dec._x = 10;dec._y = baseY;scrPane.setSize(340,transcriptH);]]></SCR>					</PG>					<PG name="events&Functions">						<INT id="transControls" name="events" perpetual="1">							<RES name="onEnterFrame" type="event" eventName="onEnterFrame" icon="mediaIcon" erase="1" exit="0">								<SCR name="highlight"><![CDATA[//find the current chunk index - we have the position of the sound. Need to loop over chunks and find the indexticks++; //a timer to prevent the stopper triggering too early when playing chunksif (mediaType == 'sound'){  pos = mediaIcon.sound.position / 1000;} else if (mediaType == 'youtube'){  if (!isNaN(engine[ytIDMain].getCurrentTime())){    pos = Number(engine[ytIDMain].getCurrentTime());  }    } else {  pos = mediaIcon.flvPlayer.playheadTime;}chunkIndex = -1;for (i = 0; i < trans.p.length; i++){  if (pos >= Number(trans.p[i].begin)){    chunkIndex = i;  } else {    break;  }}//highlight and animateif (chunkIndex != -1){    chunk = chunks.children[chunkIndex];    if (chunk != lastChunk){    lastChunk.clear();    lastChunk = chunk;        chunk.beginFill(0xFFFFAA,100);    chunk.drawRect(0,0,scrPane._width,chunk._height);        scrPane.setScrollPosition(0,chunk._y);  }} else { //sound is stopped  chunk.clear();  lastChunk = 0;  }//finish a chunk?if (playingChunk == true){  if (pos >= endTime){    if (ticks > 10){      stopChunk();    }  }}]]></SCR>							</RES>							<RES name="onSoundComplete" type="event" eventName="onSoundComplete" icon="mediaIcon" erase="1" exit="0">								<SCR name="reset"><![CDATA[chunk.clear();chunkOffset = 0;scrPane.setScrollPosition(0,0);]]></SCR>							</RES>							<RES name="onMovieComplete" type="event" eventName="onMovieComplete" icon="mediaIcon" erase="1" exit="0">								<SCR name="reset"><![CDATA[chunk.clear();chunkOffset = 0;scrPane.setScrollPosition(0,0);]]></SCR>							</RES>						</INT>					</PG>				</DEC>				<COM id="cpad" name="characterPad" url="templatePath + 'common/charPad.swf'" initObject="{language: templateData.learningObject[0].language}" />				<INT id="myInt" name="eventHandlers" perpetual="0">					<RES name="onInit" type="event" eventName="onInit" icon="rootIcon" erase="1" exit="0">						<SCR name="jump"><![CDATA[rootIcon.setDisplayMode(templateData.learningObject[0].displayMode);helpIcon._visible = false;]]></SCR>					</RES>					<RES name="onThemeChange" type="event" eventName="onThemeChange" icon="rootIcon" erase="1" exit="0">						<SCR name="update"><![CDATA[entryFrame.beginFill(STYLES.statusBarColour, 100);entryFrame.drawRect(0,0,360,516);entryFrame.beginFill(0xFFFFFF,100);rootIcon.setPageTitle(rootIcon.pages[rootIcon.currentPage].XMLElement.attributes.title);clearInterval(mediaIcon.resetID);]]></SCR>					</RES>					<RES name="onClosePage" type="event" eventName="onClosePage" icon="rootIcon" erase="1" exit="0">						<SCR name="stopChunk"><![CDATA[stopChunk();if (engine[ytID] != undefined){    engine[ytID].destroy();  delete engine[ytID];}]]></SCR>					</RES>					<RES name="showHelp" type="hotObject" rs="helpIcon" click="1" cursor="1" erase="1" exit="0">						<SCR name="showHelp"><![CDATA[helpWin = rootIcon.pages[rootIcon.currentPage].newWindow(460,60,240,360,'Help');d = helpWin.addDisplay('text',5,25,230,10,null,helpStr);]]></SCR>					</RES>				</INT>			</FW_ENT>		</IFC>		<BIN myLongVarName="A variable for tracking the user" name="Deleted Items" />	</LO>