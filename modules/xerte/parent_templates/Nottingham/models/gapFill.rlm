	<PG name="gapFill">		<SCR name="getPageID"><![CDATA[pageIcon = icon.parentNode.clip();myXML = new XML(extXML.firstChild.childNodes[rootIcon.getPageIndex() - pgOffset]);pageIcon.templateData = myXML.toObject();rootIcon.setTitleText(templateData.learningObject[0].name);ts = STYLES.inputSize;//icon.parentNode.getChildByName('passage').attributes.textSize = ts;//icon.parentNode.getChildByName('lbls').attributes.textSize = ts;panelWidth = pageIcon.templateData.gapFill[0].panelWidth;if (panelWidth == "Small"){  panelW = 300;  textW = 440;} else if (panelWidth == "Medium"){  panelW = 450;  textW = 290;} else if (panelWidth == "Large"){  panelW = 600;  textW = 150;} else {  panelW = 760;  textW = 0;}if (pageIcon.templateData.title[0].narration){  narration = pageIcon.templateData.title[0].narration;  rootIcon.broadcast('showAudio');}]]></SCR>		<DIS h="474" w="panelW" tabIndex="-1" id="panel" name="panel" x="780 - panelW" y="20" type="ext" url="templatePath + 'common/whitePanel.swf'"><![CDATA[]]></DIS>		<DIS id="textBlock" h="10" name="text" x="20" y="20" w="textW" type="text"><![CDATA[{pageIcon.templateData.gapFill[0].text}]]></DIS>		<SCR name="preprocess"><![CDATA[//preparse the textstr = pageIcon.templateData.gapFill[0].passage;str = replace(str, '  ', ' ');//str = replace(str, '\r', '');//if drag and drop, then add padding to the wordsif (pageIcon.templateData.gapFill[0].interactivity == 'Drag Drop'){  token = '¬¬¬¬¬¬¬¬';    for (i = 0; i < str.length; i++){      if (str.substr(i,1) == '|'){ //add n random chars to the string after the first | of a pair            wordLength = str.indexOf('|', i + 1) - i - 1;      if (wordLength <= 4){        padding = 4 - wordLength;      } else if (wordLength <= 8){        padding = 8 - wordLength;      } else {         padding = Math.floor(Math.random() * 5);      }            tempStr = '|' + token.substr(0, padding);      str = str.substr(0,i) + tempStr + str.substr(i + 1);      i = str.indexOf('|', i + 1);    }  }}//done padding for drag and drop - the rest of the code is the samelbls = '';paras = str.split('\r');nIndex = -1;notes = new Array();for (j = 0; j < paras.length; j++){    arr = paras[j].split(' ');    for (i = 0; i < arr.length; i++){        nIndex++;    if (arr[i].indexOf('|') != -1){      note = new Object();      note.index = nIndex;      note.start = arr[i].indexOf('|');      note.end = arr[i].lastIndexOf('|') - 2;      note.string = arr[i].substr(note.start + 1, note.end - note.start + 1);      note.string = replace(note.string, '¬', '');            lbls += note.string + ' ';            notes.push(note);    }  }}str = replace(str, '|', '');//add any additional distractorsif (pageIcon.templateData.gapFill[0].noise != undefined){  lbls += pageIcon.templateData.gapFill[0].noise;}]]></SCR>		<DIS tabIndex="-1" textColour="#333333" id="mainText" name="passage" x="panel._x + 20;" y="panel._y + 20" w="panelW - 40" h="10" type="text"><![CDATA[{str}]]></DIS>		<SCR name="setupInteraction"><![CDATA[n = 0;words = mainText.breakApart(3,7,false, false);targets = new Array();for (i = 0; i < notes.length; i++){  word = words[notes[i].index];    word.tabIndex = -1;    o = word.getRangeMetrics(notes[i].start, notes[i].end);   word.createEmptyMovieClip('mask',9);  word.mask.beginFill(0xFFFF99,100);  word.mask.drawRect(o.start + 2, 2, o.end, o.height);    word.string = notes[i].string;  word.xStart = o.start;  word.xWidth = o.end;    targets.push(word);}]]></SCR>		<DIS tabIndex="-1" textColour="#FF0000" id="lbls" name="lbls" x="mainText._x" y="mainText._y + mainText._height + 10" w="400" h="10" type="text"><![CDATA[{lbls}]]></DIS>		<SCR name="makeInteraction"><![CDATA[//what type of interaction is this?if (pageIcon.templateData.gapFill[0].interactivity == 'Drag Drop'){  labels = lbls.breakApart(13,33,true,true);    for (i = 0; i < labels.length; i++){    labels[i].string = labels[i].txt.text;  }    //randomise position  labels.randomize();  initX = 0;  initY = 0;  for (i = 0; i < labels.length; i++){      labels[i]._x = initX;    labels[i]._y = initY;      initX += labels[i]._width + 3;      if (initX + labels[i + 1]._width > mainText._width){      initX = 0;      initY += 20;    }    //store the initX and Y for replacement    labels[i].initX = labels[i]._x;    labels[i].initY = labels[i]._y;  }  if (icon.attributes.built != 'true'){    icon.nextSibling.firstChild.removeNode();    icon.attributes.built = 'true';  }} else {  lbls.removeMovieClip();  icon.nextSibling.childNodes[i].removeNode();    if (icon.attributes.built != 'true'){        icon.nextSibling.firstChild.duplicate(targets.length - 1);    icon.attributes.built = 'true';    for ( i = 0; i < targets.length; i++){      icon.nextSibling.childNodes[i].attributes.phrase = targets[i].string;    }  }}lbls.tabChildren = false;count = 0;]]></SCR>		<INT id="gapInt" name="mainInteraction" perpetual="0">			<RES name="protoTextEntry" type="textEntry" x="mainText._x +  targets[icon.index()]._x+ targets[icon.index()].xStart" y="mainText._y + targets[icon.index()]._y" w="targets[icon.index()].xWidth + 4" h="100" phrase="coded" scrolling="0" border="0" erase="1" exit="0">				<SCR name="onMatch"><![CDATA[tf = icon.parentNode.clip();tf.border = false;tf.type = "dynamic";tf.htmlText = '<font color="#006600">' + tf.text + '</font>';count++;Selection.setFocus(icon.parentNode.nextSibling.clip());if (count == targets.length){  gapInt.broadcast("showFeedback");}]]></SCR>			</RES>			<RES name="onWordDropped" type="event" eventName="onWordDropped" icon="lbls" erase="1" exit="0">				<SCR name="test"><![CDATA[//check all targetssuccess = false;for (i = 0; i < targets.length; i++){  if (lbls.wordDropped.hitTest(targets[i]) == true && lbls.wordDropped.string == targets[i].string){    matchedTarget = targets[i];    success = true;    count++;  }}if (success == true){  lbls.wordDropped._x = matchedTarget.xStart + matchedTarget._x - (lbls._x - mainText._x);  lbls.wordDropped._y = matchedTarget._y - (lbls._y - mainText._y);  lbls.wordDropped.onPress = fnull;  lbls.wordDropped.onRelease = fnull;  lbls.wordDropped.useHandCursor = false;  lbls.wordDropped.colourText('#006600');  } else {  lbls.wordDropped.animate(lbls.wordDropped.initX,lbls.wordDropped.initY,10,'quadBez',1);}if (count == targets.length){  gapInt.broadcast("showFeedback");}]]></SCR>			</RES>			<RES name="showFeedback" type="event" eventName="showFeedback" icon="gapInt" erase="1" exit="0">				<DIS transition="wipe('in', 0.5, 'None', 'easeNone')" name="feedback" x="panel._x + 20" y="mainText._y + mainText._height + 20" w="400" h="10" type="text"><![CDATA[{pageIcon.templateData.gapFill[0].feedback}]]></DIS>			</RES>		</INT>	</PG>