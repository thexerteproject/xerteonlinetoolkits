<script type="text/javascript">
/**
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for
 * additional information regarding copyright ownership.

 * The Apereo Foundation licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at:
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.

 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
	
	// pageChanged & sizeChanged functions are needed in every model file
	// other functions for model should also be in here to avoid conflicts
	var menu = new function() {

		// function called every time the page is viewed after it has initially loaded
		this.pageChanged = function() {
			if (x_params.menuImage != undefined && x_params.menuImage != "" && x_params.navigation != "Linear" && x_params.menuImageProperties == "Full Screen") {
				this.setUpBg();
			}

            XENITH.PAGEMENU.tickViewed();
		}
		
		// function called every time the size of the LO is changed
		this.sizeChanged = function() {
            // panel will be fixed height (100% of available height) if panel style is on, unless there is text above &/or below the panel
            XENITH.SPLITSCREEN.resizePanel();
		}
		
		this.init = function() {
			XENITH.PAGEMENU.build($("#panel"));
		}

        // called from PAGEMENU in xenith after TOC has been set up
        // continues set up of menu page with things that aren't relevant to TOC showing in dialog, lightbox or sidebar
		this.setUpMenuPage = function() {
            // does the menu page contain an image?
            if (x_params.menuImage != undefined && x_params.menuImage != "") {
                x_checkMediaExists(x_evalURL(x_params.menuImage), function (mediaExists) {
                    if (mediaExists) {
                        if (x_params.menuImageProperties != "Full Screen") {
                            // image in panel next to TOC
                            $("#textHolder").append('<img class="panel centre" />');

                            $("#textHolder img")
                                .one("load", function () {
                                    menu.continueSetUp();
                                })
                                .attr({
                                    "id": "pageImg",
                                    "alt": x_params.menuImageAlt != undefined ? x_params.menuImageAlt : "",
                                    "src": x_evalURL(x_params.menuImage)
                                })
                                .each(function () { // called if loaded from cache as in some browsers load won't automatically trigger
                                    if (this.complete) {
                                        $(this).trigger("load");
                                    }
                                });

                        } else {
                            // background image
                            menu.setUpBg();
                            menu.continueSetUp();
                        }

                    } else {
                        menu.continueSetUp();
                    }
                });

            } else {
                menu.continueSetUp();
            }
        }

        this.continueSetUp = function() {
            if (x_params.menuText != undefined && x_params.menuText.trim() != "") {
                $("#textHolder").append(x_params.menuText);
            }

            // all xml properties for menu page are named differently to normal page models
            // send correct data to split screen function
            const attributes = {
                panelWidth: x_params.menuPanelWidth,
                panelWidthCustom: x_params.menuPanelWidthCustom,
                panelPosition: x_params.menuAlign != undefined ? x_params.menuAlign : "Left", // for backwards compatibility, default should be left if not set manually
                panelStyle: x_params.menuPanelStyle != "true" ? "true" : "false", // data is reversed as the property is called 'Show in panel' rather than 'Remove panel style'
                removeTxt: x_params.menuText != undefined && x_params.menuText != "" ? "false" : "true", // manually set value as it's not an option in editor
                pageTxt: $("#textHolder").html().trim() // this will be empty or will contain menuTxt &/or menuImage
            }

            const elements = {
                holder: $("#tocMenuPage") // parent of text & panel columns
            }

            // set up split screen layout
            XENITH.SPLITSCREEN.init({"attributes": attributes, "elements": elements});

            this.sizeChanged();
			x_pageLoaded();
		}
		
		// function sets up full screen bg image
		this.setUpBg = function() {
            $("#x_mainBg").hide();

            var $pageBg = $('<img id="pageBg' + x_currentPage + '" class="pageBg"/>');
            $pageBg
                .hide()
                .one("load", function() {
                    $(this).fadeIn();
                })
                .attr("src", x_evalURL(x_params.menuImage))
                .each(function() { // called if loaded from cache as in some browsers load won't automatically trigger
                    if (this.complete) {
                        $(this).trigger("load");
                    }
                });

            $x_background.prepend($pageBg);
		}
	}
	
	menu.init();

</script>

<div id="tocMenuPage">

    <div id="textHolder" class="splitScreen_A"></div>

    <div id="infoHolder" class="splitScreen_B">
        <div id="panel" class="panelContent panel"></div>
    </div>

</div>