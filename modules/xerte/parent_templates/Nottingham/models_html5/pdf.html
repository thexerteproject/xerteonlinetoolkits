<script type="text/javascript">
/**
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for
 * additional information regarding copyright ownership.

 * The Apereo Foundation licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at:
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.

 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
	
	// pageChanged & sizeChanged functions are needed in every model file
	// other functions for model should also be in here to avoid conflicts
	var pdf = new function() {
		// function called every time the page is viewed after it has initially loaded
		this.pageChanged = function() {
		}
		
		// function called every time the size of the LO is changed
		this.sizeChanged = function() {
			// panel will be fixed height (100% of available screen height) at all times
			XENITH.SPLITSCREEN.resizePanel();

			// panel is the correct height - now make sure the PDF embed is the correct height within the panel
			let excludeH = $("#link").length > 0 ? [$("#link"), $("#link hr").height(), parseInt($("#link hr").css("margin-top"))] : [];
			$("#pdfDoc").height(x_getAvailableHeight([$("div.panelContent"), $("#pdfDoc")], excludeH, true));

			if (x_browserInfo.iOS == true) {
				$("#pdfDoc").width(pdf.calcWidth());
			}
		}
		
		this.init = function() {

			$("#textHolder").html(x_addLineBreaks(x_currentPageXML.getAttribute("text")));

			// tweak a lot of the page layout attributes before sending to split screen function to ensure backwards compatibility
			// old attributes (position & pdfWidth) will always override the newer attributes (they can be deleted in editor to make newer ones take over)
			let position = x_currentPageXML.getAttribute("position") != undefined ? (x_currentPageXML.getAttribute("position") == "L" ? "right" : x_currentPageXML.getAttribute("position") == "R" ? "left" : "top") : x_currentPageXML.getAttribute("align");
			let width = x_currentPageXML.getAttribute("pdfWidth") != undefined ? x_currentPageXML.getAttribute("pdfWidth") : x_currentPageXML.getAttribute("panelWidth");
			// if position is top, width will always be full
			if (position === "top") {
				width = "Full";
				position = "left"; // as it's full width this is ignored but top is no longer an expected value to change to a valid (but ignored) value to avoid problems
			}
			if ((width == undefined || x_currentPageXML.getAttribute("pdfWidth") != undefined) && (x_currentPageXML.getAttribute("text") == undefined || x_currentPageXML.getAttribute("text").trim() == "")) {
				// if no width was set (or has old width property) & no text, the pdf width is full
				width = "Full";
			} else if (width == undefined) {
				// if no width & some text, the pdf width is medium
				width = "Medium";
			}

			// send amended data to split screen function
			const attributes = {
				panelWidth: width,
				panelPosition: position,
				removeTxt: x_currentPageXML.getAttribute("removeTxt") == null ? "false" : x_currentPageXML.getAttribute("removeTxt"),
				fullH: true // force panel to be 100% height of screen at all times
			}

			// set up split screen layout
			XENITH.SPLITSCREEN.init({"attributes": attributes});

			if (x_browserInfo.iOS == true) {
				$("#pdfPage").html('<div id="pdfCover" /><object onload="pdf.createCover()" id="pdfDoc" data="' + x_evalURL(x_currentPageXML.getAttribute("url")) + '" type="application/pdf" width="' + pdf.calcWidth() + '"><param name="src" value="' + x_evalURL(x_currentPageXML.getAttribute("url")) + '"></object>');
			} else {
				$("#pdfPage").prepend('<object id="pdfDoc" data="' + x_evalURL(x_currentPageXML.getAttribute("url")) + '" type="application/pdf" width="100%"><param name="src" value="' + x_evalURL(x_currentPageXML.getAttribute("url")) + '"></object>');
			}
			this.createLink();

			this.sizeChanged();
			x_pageLoaded();
		}
		
		this.createCover = function() {
			setTimeout(function(){
				$("#link").remove();
				$("#pdfCover").css({
					width:	$("#pdfPage").width(),
					height: $("#pdfPage").height()
				});
				pdf.createLink();
			}, 1);
		}
		
		this.createLink = function() {
			const faIcon = '<i class="fa fa-external-link-alt " aria-label="' + x_getLangInfo(x_languageData.find('screenReaderInfo')[0], 'newWindow', 'opens in a new window') + '"></i>';
			$("#pdfPage").append('<div id="link"><hr/><a id="pdfLink" href="' + x_evalURL(x_currentPageXML.getAttribute("url")) + '" target="_blank">' + (x_currentPageXML.getAttribute("open") == "" || x_currentPageXML.getAttribute("open") == undefined ? "Open PDF in new tab" : x_currentPageXML.getAttribute("open")) + ' ' + faIcon + '</a></div>');
		}
		
		this.calcWidth = function() {
			if ($("#textHolder").length > 0 && x_browserInfo.mobile == false) {
				return $x_pageHolder.width() - $("#textHolder").width() - parseInt($("div.right").css("margin-left")) - (parseInt($x_pageDiv.css("padding-left")) * 2) - (parseInt($("#panel").css("padding-left")) * 2);
			} else {
				return $x_pageHolder.width() - (parseInt($x_pageDiv.css("padding-left")) * 2) - (parseInt($("#panel").css("padding-left")) * 2);
			}
		}
	}
	
	pdf.init();
	
</script>


<div id="pageContents">

	<div id="textHolder" class="splitScreen_A"></div>

	<div id="infoHolder" class="splitScreen_B">
		<div id="panel" class="panelContent panel">
			<div id="pdfPage"></div>
		</div>
	</div>

</div>


