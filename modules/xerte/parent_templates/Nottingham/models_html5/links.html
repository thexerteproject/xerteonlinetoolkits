<script type="text/javascript">
/**
 * Licensed to The Apereo Foundation under one or more contributor license
 * agreements. See the NOTICE file distributed with this work for
 * additional information regarding copyright ownership.

 * The Apereo Foundation licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at:
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.

 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

	// pageChanged & sizeChanged functions are needed in every model file
	// other functions for model should also be in here to avoid conflicts
	var links = new function() {
		// function called every time the page is viewed after it has initially loaded
		this.pageChanged = function() {
		}

		// function called every time the size of the LO is changed
		this.sizeChanged = function(firstLoad) {
		}

		this.init = function() {
			const $linkHolder = $("#linkHolder");

			// add full width text above &/or below the columns
			if (x_currentPageXML.getAttribute("text") != undefined && x_currentPageXML.getAttribute("text").trim() != "") {
				$("#textHolder").html(x_addLineBreaks(x_currentPageXML.getAttribute("text")));
			} else {
				$("#textHolder").remove();
			}

			if (x_currentPageXML.getAttribute("textTop") != undefined && x_currentPageXML.getAttribute("textTop").trim() != "") {
				$('<div class="textTopHolder">' + x_addLineBreaks(x_currentPageXML.getAttribute("textTop")) + '</div>').insertBefore($linkHolder);
			}

			if (x_currentPageXML.getAttribute("textBottom") != undefined && x_currentPageXML.getAttribute("textBottom").trim() != "") {
				$('<div class="textBottomHolder">' + x_addLineBreaks(x_currentPageXML.getAttribute("textBottom")) + '</div>').insertAfter($linkHolder);
			}
			
			// warn that links open in new window (for screen readers)
			var linkWarning = x_getLangInfo(x_languageData.find("screenReaderInfo")[0], "newWindow", "");
			var lbWarning = x_getLangInfo(x_languageData.find("screenReaderInfo")[0], "dialog", "");

			var $linkBlock = $(".linkBlock:first");
			$(x_currentPageXML).children().each(function(i) {
				var $thisLink;
				if (i != 0) {
					$thisLink = $linkBlock.clone().appendTo($linkHolder);
				} else {
					$thisLink = $linkHolder;
				}

				if (this.getAttribute("name").trim() === '' || x_currentPageXML.getAttribute("showTitles") === "false") {
					$thisLink.find("h3").hide();
				} else {
					$thisLink.find("h3")
							.attr("id", "link" + i)
							.html(this.getAttribute("name"))
							.show();
				}

				if (this.getAttribute("text").trim() === '') {
					$thisLink.find(".info").hide();
				} else {
					$thisLink.find(".info")
							.html(x_addLineBreaks(this.getAttribute("text")))
							.show();
				}

				if (this.getAttribute("url").trim() === '') {
					$thisLink.find(".link").hide();

				} else {
					// the text read by screen reader for link (instead of url)
					// this will be urlTxt (if exists) or name (if exists) or url, followed by the link warning that it opens in new window (if it does)
					var screenreaderTxt = (this.getAttribute("urlTxt") != undefined && this.getAttribute("urlTxt") != "" ? this.getAttribute("urlTxt") : (this.getAttribute("name") != "" ? this.getAttribute("name") : this.getAttribute("url"))) + (this.getAttribute("target") != "lightbox" ? ": " + linkWarning : ": " + lbWarning);

					const faIcon = '<i class="fa fa-external-link-alt " aria-label="' + x_getLangInfo(x_languageData.find('screenReaderInfo')[0], 'newWindow', 'opens in a new window') + '"></i>';
					$thisLink.find(".link a")
							.html((this.getAttribute("urlTxt") != undefined && this.getAttribute("urlTxt") != "" ? this.getAttribute("urlTxt") : this.getAttribute("url")) + (this.getAttribute("target") != "lightbox" ? ' ' + faIcon : ''))
							.attr({
								"href" : this.getAttribute("url"),
								"target" : "_blank",
								"aria-label" : screenreaderTxt
							});

					$thisLink.find(".link").show();
				}

				if (this.getAttribute("target") == "lightbox") {
					$thisLink.addClass("lb");
				}
			});

			$(".linkBlock.lb .link a").attr('data-featherlight', 'iframe');

			// set a minimum width for the columns - columns will wrap onto a new row rather than be shown smaller than this
			$linkHolder.css("grid-template-columns", "repeat(auto-fit, minmax(" + (x_currentPageXML.getAttribute("minWidth") != undefined ? x_currentPageXML.getAttribute("minWidth") : "75") + "px, 1fr))");

			// add a panel style if needed
			if (x_currentPageXML.getAttribute("panelStyle") === "single") {
				$linkHolder.addClass("panel");
			} else if (x_currentPageXML.getAttribute("panelStyle") !== "none") { // default is a panel for each link
				$linkHolder.find(".linkBlock").addClass("panel");
			}

			// these calculations are for when page could fit more than x no. of columns - make sure the no. of columns is still used alongside the min column width
			const minW = (x_currentPageXML.getAttribute("minWidth") != undefined ? x_currentPageXML.getAttribute("minWidth") : "75") + "px";
			const gap = $linkHolder.css("gap");
			const numCols = x_currentPageXML.getAttribute("cols") < 1 ? 3 : x_currentPageXML.getAttribute("cols");

			$("<style>")
				.prop("type", "text/css")
				.html(`
				@container page-contents (min-width: calc(${minW}*${numCols} + (${gap}*${numCols-1}))) {
					#linkHolder {
						grid-template-columns: repeat(${numCols}, 1fr) !important;
					}
				}`)
				.appendTo($("#pageContents"));

			x_pageLoaded();
		}
	}

	links.init();

</script>

<div id="pageContents">
	<div id="textHolder"></div>

	<div id="linkHolder">
		<div class="linkBlock">
			<h3 class="title"></h3>
			<div class="info"></div>
			<p class="link"><a></a></p>
		</div>
	</div>
</div>